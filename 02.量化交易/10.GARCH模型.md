# GARCH 模型：波动率建模

## 目录
1. [GARCH 模型概述](#一-garch-模型概述)
2. [ARCH 模型](#二-arch-模型)
3. [GARCH 模型](#三-garch-模型)
4. [GARCH 模型的扩展](#四-garch-模型的扩展)
5. [模型估计](#五-模型估计)
6. [模型诊断](#六-模型诊断)
7. [ARMA-GARCH 组合模型](#七-arma-garch-组合模型)
8. [实际应用](#八-实际应用)
9. [GARCH 模型的检验方法](#九-garch-模型的检验方法)

---

## 一、GARCH 模型概述

### 1.1 什么是 GARCH 模型

**GARCH（Generalized Autoregressive Conditional Heteroskedasticity）**，即**广义自回归条件异方差模型**，是用于建模时间序列波动率（方差）的模型。

**核心思想：**
- 金融时间序列的波动率（方差）不是常数，而是随时间变化的
- 波动率具有**波动聚类**（Volatility Clustering）特征
- 大波动后往往跟随大波动，小波动后往往跟随小波动

### 1.2 为什么需要 GARCH 模型

#### 1.2.1 ARMA 模型的局限性

**ARMA 模型的假设：**
- 残差的方差是常数：$\text{Var}(\varepsilon_t) = \sigma^2$（同方差）
- 残差是独立同分布的

**金融数据的现实：**
- ❌ 残差的方差随时间变化（异方差）
- ❌ 波动率具有聚类特征
- ❌ 大波动后往往跟随大波动

#### 1.2.2 波动聚类的直观理解

**波动聚类（Volatility Clustering）的特征：**

```
收益率序列：
时间 t:  0.01,  0.02, -0.01,  0.01,  0.01  (小波动)
时间 t: -0.05, -0.08,  0.06, -0.04,  0.07  (大波动)
时间 t:  0.01,  0.02, -0.01,  0.01,  0.01  (小波动)
```

**观察：**
- 小波动聚集在一起
- 大波动聚集在一起
- 波动率不是随机的，而是有记忆的

### 1.3 GARCH 模型的应用

**主要应用：**

1. **波动率预测**
   - 预测未来波动率
   - 用于风险管理（VaR 计算）
   - 用于期权定价

2. **风险管理**
   - 计算风险价值（VaR）
   - 动态调整投资组合

3. **资产定价**
   - 期权定价（Black-Scholes 模型需要波动率）
   - 波动率交易

4. **金融建模**
   - 与 ARMA 模型结合，同时建模均值和波动率
   - 捕捉金融时间序列的动态特征

---

## 二、ARCH 模型

### 2.1 ARCH 模型的提出

**ARCH（Autoregressive Conditional Heteroskedasticity）**模型由 Engle (1982) 提出，是 GARCH 模型的前身。

**核心思想：**
- 条件方差依赖于过去的平方残差
- 波动率具有自回归结构

### 2.2 ARCH(q) 模型

#### 2.2.1 模型定义

**ARCH(q) 模型：**

$$
\begin{align}
r_t &= \mu_t + \varepsilon_t \\
\varepsilon_t &= \sigma_t z_t \\
\sigma_t^2 &= \omega + \sum_{i=1}^{q} \alpha_i \varepsilon_{t-i}^2
\end{align}
$$

其中：
- $r_t$ 是收益率（或去均值后的序列）
- $\mu_t$ 是条件均值（可以是常数或 ARMA 模型）
- $\varepsilon_t$ 是残差
- $\sigma_t^2$ 是条件方差（波动率）
- $z_t \sim \mathcal{N}(0, 1)$ 是标准化残差（独立同分布）
- $\omega > 0$ 是常数项
- $\alpha_i \geq 0$ 是 ARCH 系数

#### 2.2.2 模型解释

**条件方差方程：**

$$
\sigma_t^2 = \omega + \alpha_1 \varepsilon_{t-1}^2 + \alpha_2 \varepsilon_{t-2}^2 + \cdots + \alpha_q \varepsilon_{t-q}^2
$$

**含义：**
- 当前波动率依赖于过去 $q$ 期的平方残差
- 如果过去有大的波动（$\varepsilon_{t-i}^2$ 大），当前波动率也会大
- 这解释了波动聚类现象

#### 2.2.3 参数约束

**非负约束：**
- $\omega > 0$
- $\alpha_i \geq 0$，$i = 1, 2, \ldots, q$

**平稳性条件：**
- $\sum_{i=1}^{q} \alpha_i < 1$

### 2.3 ARCH(1) 模型示例

**ARCH(1) 模型：**

$$
\begin{align}
r_t &= \mu + \varepsilon_t \\
\varepsilon_t &= \sigma_t z_t \\
\sigma_t^2 &= \omega + \alpha_1 \varepsilon_{t-1}^2
\end{align}
$$

**特点：**
- 最简单的 ARCH 模型
- 波动率只依赖于上一期的平方残差
- 如果 $\varepsilon_{t-1}^2$ 大，则 $\sigma_t^2$ 大

---

## 三、GARCH 模型

### 3.1 GARCH 模型的提出

**GARCH 模型由 Bollerslev (1986) 提出**，是对 ARCH 模型的推广。

**改进：**
- ARCH 模型需要很多滞后项才能捕捉波动率的持续性
- GARCH 模型用更少的参数达到同样的效果
- GARCH(1,1) 通常就足够了

### 3.2 GARCH(p,q) 模型

#### 3.2.1 模型定义

**GARCH(p,q) 模型：**

$$
\begin{align}
r_t &= \mu_t + \varepsilon_t \\
\varepsilon_t &= \sigma_t z_t \\
\sigma_t^2 &= \omega + \sum_{i=1}^{q} \alpha_i \varepsilon_{t-i}^2 + \sum_{j=1}^{p} \beta_j \sigma_{t-j}^2
\end{align}
$$

其中：
- $p$ 是 GARCH 项的阶数
- $q$ 是 ARCH 项的阶数
- $\beta_j$ 是 GARCH 系数

#### 3.2.2 模型解释

**条件方差方程：**

$$
\sigma_t^2 = \omega + \sum_{i=1}^{q} \alpha_i \varepsilon_{t-i}^2 + \sum_{j=1}^{p} \beta_j \sigma_{t-j}^2
$$

**组成：**
1. **常数项**：$\omega > 0$
2. **ARCH 项**：$\sum_{i=1}^{q} \alpha_i \varepsilon_{t-i}^2$（过去平方残差的影响）
3. **GARCH 项**：$\sum_{j=1}^{p} \beta_j \sigma_{t-j}^2$（过去波动率的影响）

**含义：**
- 当前波动率依赖于：
  - 过去的平方残差（ARCH 效应）
  - 过去的波动率（GARCH 效应）
- GARCH 项捕捉波动率的持续性

#### 3.2.3 参数详细解释

**参数向量：**

$$
\boldsymbol{\theta} = (\omega, \alpha_1, \ldots, \alpha_q, \beta_1, \ldots, \beta_p)
$$

**参数个数：** $k = 1 + q + p$（包括常数项）

**参数含义：**

| 参数 | 含义 | 约束 |
|------|------|------|
| $\omega$ | 长期平均波动率的基础水平 | $\omega > 0$ |
| $\alpha_i$ ($i=1,\ldots,q$) | ARCH 系数，衡量过去 $i$ 期平方残差的影响 | $\alpha_i \geq 0$ |
| $\beta_j$ ($j=1,\ldots,p$) | GARCH 系数，衡量过去 $j$ 期波动率的影响 | $\beta_j \geq 0$ |

**参数的经济含义：**

- **$\alpha_i$**：衡量过去 $i$ 期的"新息"（shock）对当前波动率的影响
  - 如果 $\alpha_i$ 大，说明过去 $i$ 期的波动对当前波动率影响大
  - 通常 $\alpha_1$ 最大，$\alpha_i$ 随 $i$ 增大而减小

- **$\beta_j$**：衡量过去 $j$ 期的波动率对当前波动率的持续性影响
  - 如果 $\beta_j$ 大，说明波动率具有很强的持续性
  - 通常 $\beta_1$ 最大，$\beta_j$ 随 $j$ 增大而减小

#### 3.2.4 平稳性条件

**平稳性条件（一般形式）：**

对于 GARCH(p,q) 模型，平稳性条件为：

$$
\sum_{i=1}^{q} \alpha_i + \sum_{j=1}^{p} \beta_j < 1
$$

**无条件方差：**

如果平稳性条件满足，则无条件方差为：

$$
\text{Var}(\varepsilon_t) = \frac{\omega}{1 - \sum_{i=1}^{q} \alpha_i - \sum_{j=1}^{p} \beta_j}
$$

**持续性参数：**

$$
\lambda = \sum_{i=1}^{q} \alpha_i + \sum_{j=1}^{p} \beta_j
$$

**解释：**
- $\lambda$ 衡量波动率的持续性程度
- $\lambda$ 接近 1：波动率持续性很强
- $\lambda$ 接近 0：波动率持续性很弱
- 在金融数据中，$\lambda$ 通常在 0.9-0.99 之间

**特殊情况：**
- 如果 $\lambda = 1$：称为 **IGARCH（积分 GARCH）**，无条件方差不存在
- 如果 $\lambda > 1$：模型非平稳

#### 3.2.5 参数约束条件

**非负约束：**

$$
\begin{align}
\omega &> 0 \\
\alpha_i &\geq 0, \quad i = 1, 2, \ldots, q \\
\beta_j &\geq 0, \quad j = 1, 2, \ldots, p
\end{align}
$$

**必要性：**
- 条件方差 $\sigma_t^2$ 必须非负
- 这些约束确保 $\sigma_t^2 \geq 0$ 对所有 $t$ 成立

**平稳性约束：**

$$
\sum_{i=1}^{q} \alpha_i + \sum_{j=1}^{p} \beta_j < 1
$$

**必要性：**
- 确保模型平稳
- 确保无条件方差存在且有限

#### 3.2.6 阶数选择：如何选择 p 和 q

**选择原则：**

1. **从简单模型开始**
   - 通常从 GARCH(1,1) 开始
   - GARCH(1,1) 在大多数情况下已经足够

2. **使用信息准则**
   - 计算不同 (p,q) 组合的 AIC 和 BIC
   - 选择 AIC 或 BIC 最小的模型

3. **检查参数显著性**
   - 如果高阶参数不显著，考虑简化模型
   - 移除不显著的参数

4. **模型诊断**
   - 检验标准化残差是否为白噪声
   - 检验标准化残差平方是否无自相关
   - 如果诊断未通过，考虑增加阶数

**经验法则：**

| 情况 | 建议 |
|------|------|
| **一般金融数据** | 从 GARCH(1,1) 开始 |
| **高频数据** | 可能需要 GARCH(2,1) 或 GARCH(1,2) |
| **复杂波动率模式** | 考虑 GARCH(2,2)，但通常不需要更高阶 |
| **参数不显著** | 简化模型，移除不显著参数 |

**阶数上限：**
- 通常 $p, q \leq 2$ 或 $p, q \leq 3$
- 很少需要 $p, q > 3$
- 高阶模型容易过拟合

#### 3.2.7 不同阶数的 GARCH 模型比较

**GARCH(1,1) 模型：**

$$
\sigma_t^2 = \omega + \alpha_1 \varepsilon_{t-1}^2 + \beta_1 \sigma_{t-1}^2
$$

- **参数个数**：3
- **优点**：简单、参数少、通常足够
- **缺点**：可能无法捕捉复杂的波动率模式

**GARCH(2,1) 模型：**

$$
\sigma_t^2 = \omega + \alpha_1 \varepsilon_{t-1}^2 + \beta_1 \sigma_{t-1}^2 + \beta_2 \sigma_{t-2}^2
$$

- **参数个数**：4
- **特点**：增加了一期波动率的滞后项
- **适用**：波动率具有更强的持续性

**GARCH(1,2) 模型：**

$$
\sigma_t^2 = \omega + \alpha_1 \varepsilon_{t-1}^2 + \alpha_2 \varepsilon_{t-2}^2 + \beta_1 \sigma_{t-1}^2
$$

- **参数个数**：4
- **特点**：增加了两期平方残差的滞后项
- **适用**：新息的影响持续两期

**GARCH(2,2) 模型：**

$$
\sigma_t^2 = \omega + \alpha_1 \varepsilon_{t-1}^2 + \alpha_2 \varepsilon_{t-2}^2 + \beta_1 \sigma_{t-1}^2 + \beta_2 \sigma_{t-2}^2
$$

- **参数个数**：5
- **特点**：最复杂的一般 GARCH 模型
- **适用**：波动率模式复杂，需要更多参数

#### 3.2.8 模型选择流程

**完整的模型选择流程：**

```
步骤1: 从 GARCH(1,1) 开始
  ↓ 估计模型，检查参数显著性
  
步骤2: 如果参数显著，进行模型诊断
  ↓ 检验标准化残差和标准化残差平方
  
步骤3: 如果诊断通过
  ↓ ✅ 使用 GARCH(1,1)
  
步骤4: 如果诊断未通过或参数不显著
  ↓ 尝试其他阶数（如 GARCH(2,1), GARCH(1,2), GARCH(2,2)）
  ↓ 计算每个模型的 AIC 和 BIC
  ↓ 选择信息准则最小的模型
  
步骤5: 检查最终模型
  ↓ 参数显著性
  ↓ 模型诊断
  ↓ 如果都通过，使用该模型
```

#### 3.2.9 实际应用建议

**1. 优先使用 GARCH(1,1)**
- 在大多数情况下，GARCH(1,1) 已经足够
- 参数少，估计稳定，解释简单

**2. 避免过度复杂化**
- 不要盲目增加阶数
- 高阶模型容易过拟合
- 参数估计可能不稳定

**3. 使用信息准则**
- AIC 和 BIC 是选择模型的重要工具
- BIC 倾向于选择更简单的模型

**4. 结合模型诊断**
- 信息准则和模型诊断结合使用
- 如果诊断未通过，即使 AIC/BIC 小，也需要调整模型

**5. 考虑样本量**
- 样本量小时，使用简单模型（GARCH(1,1)）
- 样本量大时，可以考虑更复杂的模型

### 3.3 GARCH(1,1) 模型

#### 3.3.1 模型形式

**GARCH(1,1) 模型（最常用）：**

$$
\begin{align}
r_t &= \mu + \varepsilon_t \\
\varepsilon_t &= \sigma_t z_t \\
\sigma_t^2 &= \omega + \alpha_1 \varepsilon_{t-1}^2 + \beta_1 \sigma_{t-1}^2
\end{align}
$$

#### 3.3.2 参数解释

**参数含义：**

| 参数 | 含义 | 约束 |
|------|------|------|
| $\omega$ | 长期平均波动率 | $\omega > 0$ |
| $\alpha_1$ | ARCH 系数（新息的影响） | $\alpha_1 \geq 0$ |
| $\beta_1$ | GARCH 系数（波动率持续性） | $\beta_1 \geq 0$ |

**参数关系：**
- $\alpha_1$：衡量新息（shock）对波动率的影响
- $\beta_1$：衡量波动率的持续性（persistence）
- $\alpha_1 + \beta_1$：衡量波动率的持续性程度

#### 3.3.3 平稳性条件

**无条件方差：**

如果 $\alpha_1 + \beta_1 < 1$，则无条件方差为：

$$
\text{Var}(\varepsilon_t) = \frac{\omega}{1 - \alpha_1 - \beta_1}
$$

**平稳性条件：**
- $\alpha_1 + \beta_1 < 1$
- 如果 $\alpha_1 + \beta_1 = 1$，称为 IGARCH（积分 GARCH）
- 如果 $\alpha_1 + \beta_1 > 1$，模型非平稳

#### 3.3.4 波动率持续性

**持续性参数：**

$$
\lambda = \alpha_1 + \beta_1
$$

**解释：**
- $\lambda$ 接近 1：波动率持续性很强，冲击的影响会持续很久
- $\lambda$ 接近 0：波动率持续性很弱，冲击的影响很快消失
- 在金融数据中，$\lambda$ 通常在 0.9-0.99 之间

---

## 四、GARCH 模型的扩展

### 4.1 EGARCH 模型

**EGARCH（Exponential GARCH）**模型由 Nelson (1991) 提出。

**特点：**
- 允许波动率对正负冲击有非对称反应
- 使用对数形式，不需要非负约束

**EGARCH(1,1) 模型：**

$$
\ln(\sigma_t^2) = \omega + \alpha_1 z_{t-1} + \gamma_1 (|z_{t-1}| - E|z_{t-1}|) + \beta_1 \ln(\sigma_{t-1}^2)
$$

**非对称效应：**
- 如果 $\alpha_1 < 0$，负冲击（坏消息）对波动率的影响大于正冲击（好消息）
- 这捕捉了金融市场的"杠杆效应"

### 4.2 GJR-GARCH 模型

**GJR-GARCH（Glosten-Jagannathan-Runkle GARCH）**模型。

**特点：**
- 允许波动率对正负冲击有非对称反应
- 使用指示函数区分正负冲击

**GJR-GARCH(1,1) 模型：**

$$
\sigma_t^2 = \omega + \alpha_1 \varepsilon_{t-1}^2 + \gamma_1 I_{t-1} \varepsilon_{t-1}^2 + \beta_1 \sigma_{t-1}^2
$$

其中 $I_{t-1} = 1$ 如果 $\varepsilon_{t-1} < 0$，否则 $I_{t-1} = 0$。

### 4.3 TGARCH 模型

**TGARCH（Threshold GARCH）**模型，与 GJR-GARCH 类似。

### 4.4 其他扩展

- **IGARCH**：积分 GARCH，$\alpha_1 + \beta_1 = 1$
- **FIGARCH**：分数积分 GARCH，捕捉长记忆性
- **GARCH-M**：GARCH in Mean，均值依赖于波动率

---

## 五、模型估计

### 5.1 最大似然估计（MLE）

#### 5.1.1 似然函数

**假设标准化残差 $z_t \sim \mathcal{N}(0, 1)$：**

条件概率密度函数：

$$
f(r_t | \mathcal{F}_{t-1}) = \frac{1}{\sqrt{2\pi\sigma_t^2}} \exp\left(-\frac{\varepsilon_t^2}{2\sigma_t^2}\right)
$$

其中 $\mathcal{F}_{t-1}$ 是到时刻 $t-1$ 的信息集。

**对数似然函数：**

$$
\ell(\boldsymbol{\theta}) = \sum_{t=1}^{n} \ln f(r_t | \mathcal{F}_{t-1}) = -\frac{n}{2}\ln(2\pi) - \frac{1}{2}\sum_{t=1}^{n}\left[\ln(\sigma_t^2) + \frac{\varepsilon_t^2}{\sigma_t^2}\right]
$$

其中 $\boldsymbol{\theta} = (\omega, \alpha_1, \ldots, \alpha_q, \beta_1, \ldots, \beta_p)$。

#### 5.1.2 估计步骤

1. **初始化**
   - 设定初始值 $\sigma_0^2$
   - 设定参数初始值

2. **递归计算**
   - 对于 $t = 1, 2, \ldots, n$：
     - 计算 $\sigma_t^2$（使用参数和过去的值）
     - 计算 $\varepsilon_t = r_t - \mu_t$
     - 计算对数似然贡献

3. **优化**
   - 使用数值优化方法（如 BFGS）最大化对数似然函数
   - 确保参数满足约束条件

### 5.2 参数约束

**约束条件：**

1. **非负约束**
   - $\omega > 0$
   - $\alpha_i \geq 0$，$i = 1, 2, \ldots, q$
   - $\beta_j \geq 0$，$j = 1, 2, \ldots, p$

2. **平稳性约束**
   - $\sum_{i=1}^{q} \alpha_i + \sum_{j=1}^{p} \beta_j < 1$

### 5.3 初始值处理

**初始波动率：**

通常使用：
- 无条件方差：$\sigma_0^2 = \frac{\omega}{1 - \sum \alpha_i - \sum \beta_j}$
- 或样本方差：$\sigma_0^2 = \frac{1}{n}\sum_{t=1}^{n} r_t^2$

---

## 六、模型诊断

### 6.1 标准化残差检验

#### 6.1.1 标准化残差

**标准化残差：**

$$
z_t = \frac{\varepsilon_t}{\sigma_t}
$$

**理论性质：**
- 如果模型正确，$z_t$ 应该是独立同分布的白噪声
- $E[z_t] = 0$，$\text{Var}(z_t) = 1$

#### 6.1.2 检验方法

**1. Ljung-Box 检验**
- 检验标准化残差的自相关性
- 如果通过，说明标准化残差是白噪声

**2. ACF/PACF 图**
- 绘制标准化残差的 ACF 和 PACF
- 应该都在置信区间内

**3. 标准化残差平方的检验**
- 检验 $z_t^2$ 的自相关性
- 如果仍有自相关，说明 GARCH 模型不充分

### 6.2 信息准则

**AIC 和 BIC：**

$$
\text{AIC} = -2\ln(L) + 2k
$$

$$
\text{BIC} = -2\ln(L) + k\ln(n)
$$

其中 $k$ 是参数个数。

### 6.3 参数显著性

**检验每个参数的显著性：**
- t 统计量
- p-value
- 如果参数不显著，可以考虑简化模型

### 6.4 模型充分性

**检查清单：**
- ✅ 标准化残差是白噪声
- ✅ 标准化残差平方无自相关
- ✅ 所有参数显著
- ✅ 参数满足约束条件
- ✅ 模型通过信息准则比较

---

## 七、ARMA-GARCH 组合模型

### 7.1 为什么需要组合模型

**问题：**
- ARMA 模型只建模均值，假设方差是常数
- GARCH 模型只建模方差，假设均值是常数
- 金融数据同时需要建模均值和方差

**解决方案：**
- 使用 ARMA 模型建模均值
- 使用 GARCH 模型建模方差
- 组合成 ARMA-GARCH 模型

### 7.2 ARMA-GARCH 模型

#### 7.2.1 模型定义

**ARMA(p,q)-GARCH(r,s) 模型：**

$$
\begin{align}
r_t &= \mu_t + \varepsilon_t \\
\mu_t &= c + \sum_{i=1}^{p}\phi_i r_{t-i} + \sum_{j=1}^{q}\theta_j \varepsilon_{t-j} \\
\varepsilon_t &= \sigma_t z_t \\
\sigma_t^2 &= \omega + \sum_{i=1}^{s} \alpha_i \varepsilon_{t-i}^2 + \sum_{j=1}^{r} \beta_j \sigma_{t-j}^2
\end{align}
$$

**组成：**
1. **均值方程**：ARMA(p,q) 模型
2. **方差方程**：GARCH(r,s) 模型

#### 7.2.2 估计步骤

**两步估计法：**

1. **第一步：估计均值方程**
   - 使用 ARMA 模型估计 $\mu_t$
   - 得到残差 $\varepsilon_t = r_t - \hat{\mu}_t$

2. **第二步：估计方差方程**
   - 对残差 $\varepsilon_t$ 使用 GARCH 模型
   - 估计波动率 $\sigma_t^2$

**联合估计法：**
- 同时估计均值和方差方程
- 更精确，但计算更复杂

### 7.3 实际应用

**常见组合：**
- **AR(1)-GARCH(1,1)**：最简单的组合模型
- **ARMA(1,1)-GARCH(1,1)**：常用的组合模型
- **白噪声-GARCH(1,1)**：如果均值是常数

---

## 八、实际应用

### 8.1 波动率预测

#### 8.1.1 一步预测

**GARCH(1,1) 模型的一步波动率预测：**

$$
E[\sigma_{t+1}^2 | \mathcal{F}_t] = \omega + \alpha_1 \varepsilon_t^2 + \beta_1 \sigma_t^2
$$

#### 8.1.2 多步预测

**h 步预测：**

对于 GARCH(1,1) 模型，如果 $\alpha_1 + \beta_1 < 1$：

$$
E[\sigma_{t+h}^2 | \mathcal{F}_t] = \frac{\omega}{1 - \alpha_1 - \beta_1} + (\alpha_1 + \beta_1)^{h-1}\left(\sigma_{t+1}^2 - \frac{\omega}{1 - \alpha_1 - \beta_1}\right)
$$

**特点：**
- 当 $h \to \infty$ 时，预测收敛到无条件方差
- 短期预测依赖于当前波动率
- 长期预测收敛到长期平均波动率

### 8.2 风险管理：VaR 计算

#### 8.2.1 VaR 定义

**风险价值（Value at Risk, VaR）**：

在置信水平 $\alpha$ 下，未来 $h$ 期的 VaR 为：

$$
\text{VaR}_\alpha(h) = \mu_{t+h} + z_\alpha \sigma_{t+h}
$$

其中 $z_\alpha$ 是标准正态分布的 $\alpha$ 分位数。

#### 8.2.2 使用 GARCH 模型计算 VaR

**步骤：**

1. 使用 GARCH 模型预测未来波动率 $\sigma_{t+h}$
2. 假设收益率服从正态分布
3. 计算 VaR

**示例：**

对于 95% 置信水平，$z_{0.05} = -1.65$：

$$
\text{VaR}_{0.05}(1) = \mu_{t+1} - 1.65 \sigma_{t+1}
$$

### 8.3 模型选择流程

```
步骤1: 数据预处理
  ↓ 计算收益率（如果使用价格数据）
  ↓ 去均值（如果需要）
  
步骤2: 检验异方差
  ↓ 绘制收益率平方的 ACF
  ↓ ARCH 检验（Ljung-Box 检验）
  ↓ 如果存在异方差，使用 GARCH 模型
  
步骤3: 选择 GARCH 模型类型
  ↓ 从 GARCH(1,1) 开始
  ↓ 如果需要非对称效应，使用 EGARCH 或 GJR-GARCH
  
步骤4: 估计模型
  ↓ 使用 MLE 估计参数
  ↓ 检查参数显著性
  
步骤5: 模型诊断
  ↓ 标准化残差检验
  ↓ 标准化残差平方检验
  ↓ 信息准则比较
  
步骤6: 如果诊断通过，使用模型进行预测
```

### 8.4 Python 实现示例

```python
import numpy as np
import pandas as pd
from arch import arch_model

# 准备数据
returns = data  # 收益率序列

# 估计 GARCH(1,1) 模型
model = arch_model(returns, vol='GARCH', p=1, q=1, dist='normal')
fitted = model.fit()

# 查看结果
print(fitted.summary())

# 预测波动率
forecasts = fitted.forecast(horizon=10)
print(forecasts.variance.iloc[-1])

# 计算 VaR
sigma_forecast = np.sqrt(forecasts.variance.iloc[-1, 0])
VaR_95 = -1.65 * sigma_forecast
print(f"95% VaR: {VaR_95}")
```

### 8.5 注意事项

**1. 分布假设**
- 标准 GARCH 假设标准化残差服从正态分布
- 金融数据通常具有厚尾，可以考虑 t 分布

**2. 模型选择**
- GARCH(1,1) 通常就足够了
- 使用信息准则选择最优模型

**3. 参数稳定性**
- GARCH 模型的参数可能随时间变化
- 需要定期重新估计

**4. 预测准确性**
- 短期波动率预测通常较准确
- 长期预测准确性较低

---

## 总结

### 核心要点

1. **GARCH 模型的目的**：建模时变波动率，捕捉波动聚类现象

2. **GARCH(1,1) 模型**：
   - $\sigma_t^2 = \omega + \alpha_1 \varepsilon_{t-1}^2 + \beta_1 \sigma_{t-1}^2$
   - 最常用的 GARCH 模型

3. **参数解释**：
   - $\alpha_1$：新息的影响
   - $\beta_1$：波动率持续性
   - $\alpha_1 + \beta_1$：持续性程度

4. **模型估计**：使用最大似然估计（MLE）

5. **模型诊断**：检验标准化残差是否为白噪声

6. **实际应用**：波动率预测、VaR 计算、风险管理

### GARCH 模型的优势

- ✅ 捕捉波动聚类现象
- ✅ 建模时变波动率
- ✅ 参数相对较少（GARCH(1,1) 只需 3 个参数）
- ✅ 理论基础完善

### 局限性

- ⚠️ 假设标准化残差独立同分布
- ⚠️ 可能无法捕捉所有波动率特征
- ⚠️ 长期预测准确性有限

---

## 九、GARCH 模型的检验方法

### 9.1 建模前的检验：ARCH 效应检验

#### 9.1.1 为什么需要 ARCH 效应检验

**目的：**
- 在建模 GARCH 模型之前，需要检验数据是否存在 ARCH 效应（异方差）
- 如果不存在 ARCH 效应，则不需要使用 GARCH 模型
- 这是模型选择的第一步

#### 9.1.2 ARCH-LM 检验（拉格朗日乘数检验）

**ARCH-LM 检验（Engle, 1982）**是最常用的 ARCH 效应检验方法。

**检验步骤：**

1. **第一步：估计均值方程**
   - 对收益率序列 $r_t$ 估计均值方程（可以是常数或 ARMA 模型）
   - 得到残差 $\hat{\varepsilon}_t = r_t - \hat{\mu}_t$

2. **第二步：辅助回归**
   - 对残差平方进行回归：
   $$
   \hat{\varepsilon}_t^2 = \gamma_0 + \gamma_1 \hat{\varepsilon}_{t-1}^2 + \gamma_2 \hat{\varepsilon}_{t-2}^2 + \cdots + \gamma_q \hat{\varepsilon}_{t-q}^2 + u_t
   $$
   - 其中 $q$ 是检验的滞后阶数（通常 $q = 1, 2, \ldots, 10$）

3. **第三步：计算检验统计量**
   - **LM 统计量**：$LM = n \times R^2$
   - 其中 $n$ 是样本量，$R^2$ 是辅助回归的决定系数
   - 在原假设下，$LM$ 近似服从自由度为 $q$ 的 $\chi^2$ 分布

**原假设和备择假设：**

- **$H_0$**：不存在 ARCH 效应（$\gamma_1 = \gamma_2 = \cdots = \gamma_q = 0$）
- **$H_1$**：存在 ARCH 效应（至少有一个 $\gamma_i \neq 0$）

**判断标准：**
- 如果 p-value < 0.05：拒绝原假设，**存在 ARCH 效应，需要使用 GARCH 模型**
- 如果 p-value ≥ 0.05：不能拒绝原假设，**不存在 ARCH 效应，可能不需要 GARCH 模型**

#### 9.1.3 Ljung-Box 检验残差平方

**另一种检验方法：**

对残差平方 $\hat{\varepsilon}_t^2$ 进行 Ljung-Box 检验：

**Ljung-Box 统计量：**

$$
Q = n(n+2)\sum_{k=1}^{m}\frac{\hat{\rho}_k^2}{n-k}
$$

其中：
- $n$ 是样本量
- $m$ 是检验的滞后阶数
- $\hat{\rho}_k$ 是残差平方序列的样本自相关系数

**原假设和备择假设：**

- **$H_0$**：残差平方无自相关（不存在 ARCH 效应）
- **$H_1$**：残差平方存在自相关（存在 ARCH 效应）

**判断标准：**
- 如果 p-value < 0.05：拒绝原假设，**存在 ARCH 效应**
- 如果 p-value ≥ 0.05：不能拒绝原假设，**不存在 ARCH 效应**

#### 9.1.4 残差平方的 ACF 图

**视觉检验方法：**

绘制残差平方 $\hat{\varepsilon}_t^2$ 的 ACF 图：

**判断标准：**
- 如果残差平方的 ACF 在多个滞后处显著（超出置信区间），说明存在 ARCH 效应
- 如果残差平方的 ACF 都在置信区间内，说明不存在 ARCH 效应

**优点：**
- 直观，可以观察 ARCH 效应的模式
- 可以初步判断 ARCH 的阶数

### 9.2 模型估计后的检验：标准化残差检验

#### 9.2.1 标准化残差的定义

**标准化残差：**

$$
z_t = \frac{\varepsilon_t}{\sigma_t}
$$

其中：
- $\varepsilon_t$ 是原始残差
- $\sigma_t$ 是条件标准差（从 GARCH 模型估计得到）

**理论性质：**
- 如果 GARCH 模型正确，$z_t$ 应该是独立同分布的白噪声
- $E[z_t] = 0$，$\text{Var}(z_t) = 1$

#### 9.2.2 Ljung-Box 检验标准化残差

**目的：** 检验标准化残差是否为白噪声

**检验步骤：**

1. 计算标准化残差：$z_t = \frac{\hat{\varepsilon}_t}{\hat{\sigma}_t}$

2. 对标准化残差进行 Ljung-Box 检验

**Ljung-Box 统计量：**

$$
Q = n(n+2)\sum_{k=1}^{m}\frac{\hat{\rho}_k^2}{n-k}
$$

其中 $\hat{\rho}_k$ 是标准化残差序列的样本自相关系数。

**原假设和备择假设：**

- **$H_0$**：标准化残差无自相关（是白噪声）
- **$H_1$**：标准化残差存在自相关（不是白噪声）

**判断标准：**
- 如果 p-value > 0.05：不能拒绝原假设，**标准化残差是白噪声，模型充分**
- 如果 p-value ≤ 0.05：拒绝原假设，**标准化残差存在自相关，模型不充分**

**注意事项：**
- 通常检验多个滞后阶数（如 $m = 10, 20, 30$）
- 如果所有滞后阶数的检验都通过，可以认为标准化残差是白噪声

#### 9.2.3 标准化残差的 ACF/PACF 图

**视觉检验方法：**

绘制标准化残差 $z_t$ 的 ACF 和 PACF 图：

**判断标准：**
- 如果标准化残差的 ACF 和 PACF 都在置信区间内（通常为 $\pm 1.96/\sqrt{n}$），可以认为标准化残差无自相关
- 如果存在显著超出置信区间的值，说明标准化残差存在自相关

**优点：**
- 直观，可以观察自相关的模式
- 可以识别哪些滞后存在自相关

### 9.3 模型充分性检验：标准化残差平方检验

#### 9.3.1 为什么需要检验标准化残差平方

**目的：**
- 检验 GARCH 模型是否充分捕捉了波动率的动态结构
- 如果标准化残差平方仍有自相关，说明 GARCH 模型不充分
- 可能需要更高阶的 GARCH 模型或其他扩展模型

#### 9.3.2 Ljung-Box 检验标准化残差平方

**检验步骤：**

1. 计算标准化残差平方：$z_t^2 = \left(\frac{\hat{\varepsilon}_t}{\hat{\sigma}_t}\right)^2$

2. 对标准化残差平方进行 Ljung-Box 检验

**Ljung-Box 统计量：**

$$
Q = n(n+2)\sum_{k=1}^{m}\frac{\hat{\rho}_k^2}{n-k}
$$

其中 $\hat{\rho}_k$ 是标准化残差平方序列的样本自相关系数。

**原假设和备择假设：**

- **$H_0$**：标准化残差平方无自相关（GARCH 模型充分）
- **$H_1$**：标准化残差平方存在自相关（GARCH 模型不充分）

**判断标准：**
- 如果 p-value > 0.05：不能拒绝原假设，**GARCH 模型充分**
- 如果 p-value ≤ 0.05：拒绝原假设，**GARCH 模型不充分，需要改进模型**

#### 9.3.3 标准化残差平方的 ACF 图

**视觉检验方法：**

绘制标准化残差平方 $z_t^2$ 的 ACF 图：

**判断标准：**
- 如果标准化残差平方的 ACF 都在置信区间内，说明 GARCH 模型充分
- 如果标准化残差平方的 ACF 在多个滞后处显著，说明 GARCH 模型不充分

### 9.4 其他诊断检验

#### 9.4.1 标准化残差的正态性检验

**目的：** 检验标准化残差是否服从正态分布

**检验方法：**

1. **Jarque-Bera 检验**
   - 检验偏度和峰度
   - 原假设：标准化残差服从正态分布
   - 如果 p-value < 0.05，拒绝原假设

2. **Q-Q 图**
   - 绘制标准化残差的 Q-Q 图
   - 如果点大致在一条直线上，说明近似正态分布
   - 如果点偏离直线，说明不是正态分布

3. **Shapiro-Wilk 检验**
   - 小样本的正态性检验
   - 适用于样本量较小的情况

**注意：**
- GARCH 模型不要求标准化残差必须服从正态分布
- 但如果需要计算 VaR 或预测区间，正态性假设很重要
- 如果标准化残差不是正态分布，可以考虑使用 t 分布或其他分布

#### 9.4.2 参数显著性检验

**目的：** 检验 GARCH 模型的参数是否显著

**检验方法：**

对每个参数 $\theta_i$，检验：

$$
H_0: \theta_i = 0 \quad \text{vs} \quad H_1: \theta_i \neq 0
$$

**t 统计量：**

$$
t = \frac{\hat{\theta}_i}{\text{SE}(\hat{\theta}_i)}
$$

**判断标准：**
- 如果 p-value < 0.05：参数显著
- 如果 p-value ≥ 0.05：参数不显著，可以考虑从模型中移除

**注意：**
- 如果参数不显著，说明该参数对模型没有贡献
- 可以考虑简化模型，移除不显著的参数

#### 9.4.3 信息准则比较

**目的：** 比较不同 GARCH 模型的拟合优度

**AIC 和 BIC：**

$$
\text{AIC} = -2\ln(L) + 2k
$$

$$
\text{BIC} = -2\ln(L) + k\ln(n)
$$

其中：
- $L$ 是最大似然值
- $k$ 是参数个数
- $n$ 是样本量

**选择原则：**
- 选择 AIC 或 BIC 最小的模型
- BIC 的惩罚更严格，倾向于选择更简单的模型

### 9.5 完整的检验流程

#### 9.5.1 建模前的检验流程

```
步骤1: 估计均值方程
  ↓ 得到残差 ε_t
  
步骤2: ARCH 效应检验
  ├─ ARCH-LM 检验
  ├─ Ljung-Box 检验残差平方
  └─ 残差平方的 ACF 图
  ↓
  ├─ 存在 ARCH 效应 → 使用 GARCH 模型
  └─ 不存在 ARCH 效应 → 可能不需要 GARCH 模型
```

#### 9.5.2 模型估计后的检验流程

```
步骤1: 估计 GARCH 模型
  ↓ 得到标准化残差 z_t
  
步骤2: 标准化残差检验
  ├─ Ljung-Box 检验标准化残差
  └─ 标准化残差的 ACF/PACF 图
  ↓
  ├─ 通过 → 标准化残差是白噪声
  └─ 未通过 → 模型不充分，需要调整
  
步骤3: 标准化残差平方检验
  ├─ Ljung-Box 检验标准化残差平方
  └─ 标准化残差平方的 ACF 图
  ↓
  ├─ 通过 → GARCH 模型充分
  └─ 未通过 → GARCH 模型不充分，需要改进
  
步骤4: 其他诊断
  ├─ 正态性检验
  ├─ 参数显著性检验
  └─ 信息准则比较
  ↓
  ├─ 通过 → ✅ 模型完成
  └─ 未通过 → 调整模型
```

### 9.6 Python 实现示例

#### 9.6.1 ARCH 效应检验

```python
import numpy as np
import pandas as pd
from statsmodels.stats.diagnostic import acorr_ljungbox
from statsmodels.stats.diagnostic import het_arch
from statsmodels.tsa.arima.model import ARIMA

# 准备数据
returns = data  # 收益率序列

# 步骤1: 估计均值方程（假设是常数）
residuals = returns - returns.mean()

# 步骤2: ARCH-LM 检验
arch_test = het_arch(residuals, maxlag=10)
print("ARCH-LM 检验结果:")
print(f"LM 统计量: {arch_test[0]}")
print(f"p-value: {arch_test[1]}")
if arch_test[1] < 0.05:
    print("✅ 存在 ARCH 效应，需要使用 GARCH 模型")
else:
    print("❌ 不存在 ARCH 效应")

# 步骤3: Ljung-Box 检验残差平方
lb_test = acorr_ljungbox(residuals**2, lags=10, return_df=True)
print("\n残差平方的 Ljung-Box 检验:")
print(lb_test)
if (lb_test['lb_pvalue'] < 0.05).any():
    print("✅ 存在 ARCH 效应")
else:
    print("❌ 不存在 ARCH 效应")
```

#### 9.6.2 GARCH 模型诊断

```python
from arch import arch_model
from statsmodels.stats.diagnostic import acorr_ljungbox
from scipy import stats

# 估计 GARCH(1,1) 模型
model = arch_model(returns, vol='GARCH', p=1, q=1, dist='normal')
fitted = model.fit()

# 计算标准化残差
std_residuals = fitted.std_resid

# 步骤1: Ljung-Box 检验标准化残差
lb_test_resid = acorr_ljungbox(std_residuals, lags=10, return_df=True)
print("标准化残差的 Ljung-Box 检验:")
print(lb_test_resid)
if (lb_test_resid['lb_pvalue'] > 0.05).all():
    print("✅ 标准化残差是白噪声")
else:
    print("❌ 标准化残差存在自相关")

# 步骤2: Ljung-Box 检验标准化残差平方
lb_test_resid2 = acorr_ljungbox(std_residuals**2, lags=10, return_df=True)
print("\n标准化残差平方的 Ljung-Box 检验:")
print(lb_test_resid2)
if (lb_test_resid2['lb_pvalue'] > 0.05).all():
    print("✅ GARCH 模型充分")
else:
    print("❌ GARCH 模型不充分")

# 步骤3: 正态性检验（Jarque-Bera）
jb_stat, jb_pvalue = stats.jarque_bera(std_residuals)
print(f"\nJarque-Bera 检验:")
print(f"统计量: {jb_stat:.4f}")
print(f"p-value: {jb_pvalue:.4f}")
if jb_pvalue > 0.05:
    print("✅ 标准化残差服从正态分布")
else:
    print("❌ 标准化残差不服从正态分布")

# 步骤4: 参数显著性
print("\n参数估计结果:")
print(fitted.summary())
```

### 9.7 检验方法总结

#### 9.7.1 建模前的检验

| 检验方法 | 目的 | 原假设 | 判断标准 |
|---------|------|--------|----------|
| **ARCH-LM 检验** | 检验是否存在 ARCH 效应 | 不存在 ARCH 效应 | p-value < 0.05 → 存在 ARCH 效应 |
| **Ljung-Box 检验残差平方** | 检验残差平方的自相关 | 残差平方无自相关 | p-value < 0.05 → 存在 ARCH 效应 |
| **残差平方的 ACF 图** | 视觉检验 ARCH 效应 | - | 多个滞后显著 → 存在 ARCH 效应 |

#### 9.7.2 模型估计后的检验

| 检验方法 | 目的 | 原假设 | 判断标准 |
|---------|------|--------|----------|
| **Ljung-Box 检验标准化残差** | 检验标准化残差是否为白噪声 | 标准化残差无自相关 | p-value > 0.05 → 是白噪声 |
| **标准化残差的 ACF/PACF 图** | 视觉检验标准化残差 | - | 都在置信区间内 → 是白噪声 |
| **Ljung-Box 检验标准化残差平方** | 检验 GARCH 模型是否充分 | 标准化残差平方无自相关 | p-value > 0.05 → 模型充分 |
| **标准化残差平方的 ACF 图** | 视觉检验模型充分性 | - | 都在置信区间内 → 模型充分 |
| **正态性检验** | 检验标准化残差的正态性 | 标准化残差服从正态分布 | p-value > 0.05 → 服从正态分布 |
| **参数显著性检验** | 检验参数是否显著 | 参数为零 | p-value < 0.05 → 参数显著 |
| **信息准则** | 比较不同模型 | - | AIC/BIC 越小越好 |

#### 9.7.3 检验顺序建议

**完整的检验顺序：**

1. **建模前**
   - ARCH-LM 检验
   - Ljung-Box 检验残差平方
   - 残差平方的 ACF 图

2. **模型估计后**
   - Ljung-Box 检验标准化残差
   - 标准化残差的 ACF/PACF 图
   - Ljung-Box 检验标准化残差平方
   - 标准化残差平方的 ACF 图
   - 正态性检验
   - 参数显著性检验
   - 信息准则比较

3. **如果检验未通过**
   - 调整模型（增加阶数、改变模型类型）
   - 重新估计和检验
   - 直到所有检验通过

---

*GARCH 模型是金融时间序列分析中最重要的模型之一，广泛应用于波动率建模、风险管理和资产定价。理解 GARCH 模型的原理和应用，对于金融数据分析至关重要。*



